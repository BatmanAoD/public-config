" vim: ft=vim
" This is for features not available in 7.2 and earlier

set relativenumber

" Useful if not using gVim
" TODO: figure out how to turn off the RelativeFocus autogroup once I've
" used this function to take manual control of this feature.
function! ToggleRelativeNumbering()
    if(&relativenumber == 1)
        set norelativenumber
    else
        set relativenumber
    endif
endfunction
nnoremap <Leader>n :call ToggleRelativeNumbering()<cr>

augroup RelativeFocus
    if has('win32unix') 
        " With XWin, 'focus lost' apparently only occurs when a *different*
        " X window gains focus. So here's a lame but hopefully good-enough
        " alternative.
        au CursorHold * :set norelativenumber
        au CursorMoved * :set relativenumber
    else
        au FocusLost * :set norelativenumber
        au FocusGained * :set relativenumber
    endif
augroup END

set undodir=~/.vim/undodir
set undofile
set undolevels=1000 "maximum number of changes that can be undone
set undoreload=10000 "maximum number lines to save for undo on a buffer reload

" Bundles incompatible with older Vim
" These should take care of all the 'very magic' nonsense
" ......buuuuuut note that CRDispatcher actually only works with Vim 7.4+, not
" 7.3+. For now I'm not going to worry about it.
Bundle 'coot/CRDispatcher'
Bundle 'coot/EnchantedVim'
function! Disenchant()
    let g:VeryMagic = 0
    let g:VeryMagicSubstituteNormalise = 0
    let g:VeryMagicSubstitute = 0
    let g:VeryMagicGlobal = 0
    let g:VeryMagicVimGrep = 0
    let g:VeryMagicSearchArg = 0
    let g:VeryMagicFunction = 0
    let g:VeryMagicHelpgrep = 0
    let g:VeryMagicRange = 0
    let g:VeryMagicEscapeBackslashesInSearchArg = 0
    let g:SortEditArgs = 0
endfunction

" Since I use incsearch:
let g:VeryMagic = 0
nnoremap / /\v
nnoremap ? ?\v

" Turn on all other features.
let g:VeryMagicSubstituteNormalise = 1
let g:VeryMagicSubstitute = 1
let g:VeryMagicGlobal = 1
let g:VeryMagicVimGrep = 1
let g:VeryMagicSearchArg = 1
let g:VeryMagicFunction = 1
let g:VeryMagicHelpgrep = 1
let g:VeryMagicRange = 1
let g:VeryMagicEscapeBackslashesInSearchArg = 1
let g:SortEditArgs = 1
