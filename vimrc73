" vim: ft=vim
" This is for features not available in 7.2 and earlier

set relativenumber

" Useful if not using gVim
" TODO: figure out how to turn off the RelativeFocus autogroup once I've
" used this function to take manual control of this feature.
function! ToggleRelativeNumbering()
    if(&relativenumber == 1)
        set norelativenumber
    else
        set relativenumber
    endif
endfunction
nnoremap <Leader>n :call ToggleRelativeNumbering()<cr>

augroup RelativeFocus
    if has('win32unix') 
        " With XWin, 'focus lost' apparently only occurs when a *different*
        " X window gains focus. So here's a lame but hopefully good-enough
        " alternative.
        au CursorHold * :set norelativenumber
        au CursorMoved * :set relativenumber
    else
        au FocusLost * :set norelativenumber
        au FocusGained * :set relativenumber
    endif
augroup END

" using logic from http://stackoverflow.com/a/9528322/1858225
if exists("+undofile")
    set undodir=$VIMFILES/undodir/
    if isdirectory(expand(&undodir)) == 0
        if has('win32')
            :silent !mkdir \%HOMEPATH\%\vimfiles\undodir
        else
            :silent call system('mkdir -p ' . &undodir)
        endif
    endif
    set undofile
    set undolevels=1000 "maximum number of changes that can be undone
    set undoreload=10000 "maximum number lines to save for undo on a buffer reload
endif

if has('win32')
    let pluginfile73 = expand("~/_vimrc73bundles")
else
    let pluginfile73 = expand("~/.vimrc73bundles")
endif
if filereadable(pluginfile73)
  exec ":source " . pluginfile73
endif
